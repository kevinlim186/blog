<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Test</title>
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>
    <div id="chart-container"></div>

    <script>
    // Load and inject embed HTML
    fetch("http://localhost:8050/api/us-companies-cashflow-tax")
        .then(r => r.text())
        .then(html => {
            const container = document.getElementById("chart-container");
            // Inject the HTML (this adds the script tags, but doesn't execute them)
            container.innerHTML = html;

            // IMPORTANT: Manually clone and execute embedded <script> tags
            const scripts = container.querySelectorAll("script");
            
            // Use an array to store scripts
            const scriptsToExecute = [];
            
            scripts.forEach(oldScript => {
                const newScript = document.createElement("script");

                // Copy attributes (for 'src')
                for (const attr of oldScript.attributes) {
                    newScript.setAttribute(attr.name, attr.value);
                }

                // Copy content (for inline Plotly script)
                if (!oldScript.src) {
                    newScript.textContent = oldScript.textContent;
                }

                scriptsToExecute.push(newScript);
                
                // Remove original script from the injected HTML
                oldScript.remove();
            });

            // Append clones to the document body to force execution
            scriptsToExecute.forEach(script => {
                document.body.appendChild(script);
            });
        })
        .catch(error => console.error('Error fetching chart embed:', error));
    </script>

</body>
</html>